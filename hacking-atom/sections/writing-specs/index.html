<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
<title>Writing specs</title>

<link rel="stylesheet" media="all" href="/assets/stylesheets/application.css" data-proofer-ignore>

<link rel="stylesheet" media="all" href="/assets/stylesheets/development.css" data-proofer-ignore>


  </head>
  <body>
    <div class="footer-push">
      <div class="top-bar">
  <div class="wrapper no-pad">

    <ul class="navigation">
      <li><h1 title="Atom: A hackable text editor for the 21st Century"><a href="/" class="logo-small"></a></h1></li>
      <li><a href="#" data-proofer-ignore>Packages</a></li>
      <li><a href="#" data-proofer-ignore>Themes</a></li>
      <li><a class="is-selected" href="/" data-proofer-ignore>Documentation</a></li>
      <li><a href="http://blog.atom.io">Blog</a></li>
      <li><a href="http://discuss.atom.io">Discuss</a></li>
    </ul>

  </div>
</div>

      
      <div class="banner">
  <p><strong>NOTE:</strong> This is only a sample of the local output. Some features, such as versioning switching and search, are not available.</p>
</div>

      
      <div class="wrapper documents content-push wide">
        <div class="toc">
          


<ul>
  <li>
  <h4><a href="/getting-started">Chapter 1: Getting Started</a></h4>
  <ul>
    
    
      <li class="unselected">
        <small>1.1</small>
        <a href="/getting-started/sections/why-atom">Why Atom?</a>
      </li>
      
    
      <li class="unselected">
        <small>1.2</small>
        <a href="/getting-started/sections/installing-atom">Installing Atom</a>
      </li>
      
    
      <li class="unselected">
        <small>1.3</small>
        <a href="/getting-started/sections/atom-basics">Atom Basics</a>
      </li>
      
    
      <li class="unselected">
        <small>1.4</small>
        <a href="/getting-started/sections/summary">Summary</a>
      </li>
      
    
    
  </ul>
  </li>
</ul>


<ul>
  <li>
  <h4><a href="/using-atom">Chapter 2: Using Atom</a></h4>
  <ul>
    
    
      <li class="unselected">
        <small>2.1</small>
        <a href="/using-atom/sections/atom-packages">Atom Packages</a>
      </li>
      
    
      <li class="unselected">
        <small>2.2</small>
        <a href="/using-atom/sections/moving-in-atom">Moving in Atom</a>
      </li>
      
    
      <li class="unselected">
        <small>2.3</small>
        <a href="/using-atom/sections/atom-selections">Atom Selections</a>
      </li>
      
    
      <li class="unselected">
        <small>2.4</small>
        <a href="/using-atom/sections/editing-and-deleting-text">Editing and Deleting Text</a>
      </li>
      
    
      <li class="unselected">
        <small>2.5</small>
        <a href="/using-atom/sections/find-and-replace">Find and Replace</a>
      </li>
      
    
      <li class="unselected">
        <small>2.6</small>
        <a href="/using-atom/sections/snippets">Snippets</a>
      </li>
      
    
      <li class="unselected">
        <small>2.7</small>
        <a href="/using-atom/sections/autocomplete">Autocomplete</a>
      </li>
      
    
      <li class="unselected">
        <small>2.8</small>
        <a href="/using-atom/sections/folding">Folding</a>
      </li>
      
    
      <li class="unselected">
        <small>2.9</small>
        <a href="/using-atom/sections/panes">Panes</a>
      </li>
      
    
      <li class="unselected">
        <small>2.10</small>
        <a href="/using-atom/sections/grammar">Grammar</a>
      </li>
      
    
      <li class="unselected">
        <small>2.11</small>
        <a href="/using-atom/sections/version-control-in-atom">Version Control in Atom</a>
      </li>
      
    
      <li class="unselected">
        <small>2.12</small>
        <a href="/using-atom/sections/writing-in-atom">Writing in Atom</a>
      </li>
      
    
      <li class="unselected">
        <small>2.13</small>
        <a href="/using-atom/sections/basic-customization">Basic Customization</a>
      </li>
      
    
      <li class="unselected">
        <small>2.14</small>
        <a href="/using-atom/sections/summary">Summary</a>
      </li>
      
    
    
  </ul>
  </li>
</ul>


<ul>
  <li>
  <h4><a href="/hacking-atom">Chapter 3: Hacking Atom</a></h4>
  <ul>
    
    
      <li class="unselected">
        <small>3.1</small>
        <a href="/hacking-atom/sections/tools-of-the-trade">Tools of the Trade</a>
      </li>
      
    
      <li class="unselected">
        <small>3.2</small>
        <a href="/hacking-atom/sections/the-init-file">The Init File</a>
      </li>
      
    
      <li class="unselected">
        <small>3.3</small>
        <a href="/hacking-atom/sections/package-word-count">Package: Word Count</a>
      </li>
      
    
      <li class="unselected">
        <small>3.4</small>
        <a href="/hacking-atom/sections/package-modifying-text">Package: Modifying Text</a>
      </li>
      
    
      <li class="unselected">
        <small>3.5</small>
        <a href="/hacking-atom/sections/creating-a-theme">Creating a Theme</a>
      </li>
      
    
      <li class="unselected">
        <small>3.6</small>
        <a href="/hacking-atom/sections/iconography">Iconography</a>
      </li>
      
    
      <li class="unselected">
        <small>3.7</small>
        <a href="/hacking-atom/sections/debugging">Debugging</a>
      </li>
      
    
      <li class="selected">
        <small>3.8</small>
        <a href="/hacking-atom/sections/writing-specs">Writing specs</a>
      </li>
      
    
      <li class="unselected">
        <small>3.9</small>
        <a href="/hacking-atom/sections/converting-from-textmate">Converting from TextMate</a>
      </li>
      
    
      <li class="unselected">
        <small>3.10</small>
        <a href="/hacking-atom/sections/summary">Summary</a>
      </li>
      
    
    
  </ul>
  </li>
</ul>


<ul>
  <li>
  <h4><a href="/behind-atom">Chapter 4: Behind Atom</a></h4>
  <ul>
    
    
      <li class="unselected">
        <small>4.1</small>
        <a href="/behind-atom/sections/configuration-api">Configuration API</a>
      </li>
      
    
      <li class="unselected">
        <small>4.2</small>
        <a href="/behind-atom/sections/keymaps-in-depth">Keymaps In-Depth</a>
      </li>
      
    
      <li class="unselected">
        <small>4.3</small>
        <a href="/behind-atom/sections/scoped-settings-scopes-and-scope-descriptors">Scoped Settings, Scopes and Scope Descriptors</a>
      </li>
      
    
      <li class="unselected">
        <small>4.4</small>
        <a href="/behind-atom/sections/serialization-in-atom">Serialization in Atom</a>
      </li>
      
    
      <li class="unselected">
        <small>4.5</small>
        <a href="/behind-atom/sections/developing-node-modules">Developing Node Modules</a>
      </li>
      
    
      <li class="unselected">
        <small>4.6</small>
        <a href="/behind-atom/sections/interacting-with-other-packages-via-services">Interacting With Other Packages Via Services</a>
      </li>
      
    
      <li class="unselected">
        <small>4.7</small>
        <a href="/behind-atom/sections/maintaining-your-packages">Maintaining Your Packages</a>
      </li>
      
    
      <li class="unselected">
        <small>4.8</small>
        <a href="/behind-atom/sections/summary">Summary</a>
      </li>
      
    
    
  </ul>
  </li>
</ul>


<ul>
  <li>
  <h4><a href="/upgrading-to-1-0-apis">Chapter 5: Upgrading to 1.0 APIs</a></h4>
  <ul>
    
    
      <li class="unselected">
        <small>5.1</small>
        <a href="/upgrading-to-1-0-apis/sections/upgrading-your-package">Upgrading Your Package</a>
      </li>
      
    
      <li class="unselected">
        <small>5.2</small>
        <a href="/upgrading-to-1-0-apis/sections/upgrading-your-ui-theme-or-package-selectors">Upgrading Your UI Theme Or Package Selectors</a>
      </li>
      
    
      <li class="unselected">
        <small>5.3</small>
        <a href="/upgrading-to-1-0-apis/sections/upgrading-your-syntax-theme">Upgrading Your Syntax Theme</a>
      </li>
      
    
    
  </ul>
  </li>
</ul>


        </div>
        <div class="markdown-body document-content">
          <h1>3.8 Writing specs</h1>
          <div class="manual-docs">
            <div class="sect2">
<h3 id="_writing_specs">Writing specs</h3>
<div class="paragraph">
<p>We&#8217;ve looked at and written a few specs through the examples already. Now it&#8217;s time to take a closer look at the spec framework itself. How exactly do you write tests in Atom?</p>
</div>
<div class="paragraph">
<p>Atom uses <a href="http://jasmine.github.io/1.3/introduction.html">Jasmine</a> as its spec framework. Any new functionality should have specs to guard against regressions.</p>
</div>
<div class="sect3">
<h4 id="_create_a_new_spec">Create a new spec</h4>
<div class="paragraph">
<p><a href="https://github.com/atom/atom/tree/master/spec">Atom specs</a> and <a href="https://github.com/atom/markdown-preview/tree/master/spec">package specs</a> are added to their respective <code>spec</code> directory. The example below creates a spec for Atom core.</p>
</div>
<div class="sect4">
<h5 id="_create_a_spec_file">Create a spec file</h5>
<div class="paragraph">
<p>Spec files <strong>must</strong> end with <code>-spec</code> so add <code>sample-spec.coffee</code> to <code>atom/spec</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_add_one_or_more_code_describe_code_methods">Add one or more <code>describe</code> methods</h5>
<div class="paragraph">
<p>The <code>describe</code> method takes two arguments, a description and a function. If the description explains a behavior it typically begins with <code>when</code>; if it is more like a unit test it begins with the method name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-coffee" data-lang="coffee">describe "when a test is written", -&gt;
  # contents</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-coffee" data-lang="coffee">describe "Editor::moveUp", -&gt;
  # contents</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_add_one_or_more_code_it_code_method">Add one or more <code>it</code> method</h5>
<div class="paragraph">
<p>The <code>it</code> method also takes two arguments, a description and a function. Try and make the description flow with the <code>it</code> method. For example, a description of <code>this should work</code> doesn&#8217;t read well as <code>it this should work</code>. But a description of <code>should work</code> sounds great as <code>it should work</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-coffee" data-lang="coffee">describe "when a test is written", -&gt;
  it "has some expectations that should pass", -&gt;
    # Expectations</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_add_one_or_more_expectations">Add one or more expectations</h5>
<div class="paragraph">
<p>The best way to learn about expectations is to read the <a href="http://jasmine.github.io/1.3/introduction.html#section-Expectations)">Jasmine documentation</a> about them. Below is a simple example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-coffee" data-lang="coffee">describe "when a test is written", -&gt;
  it "has some expectations that should pass", -&gt;
    expect("apples").toEqual("apples")
    expect("oranges").not.toEqual("apples")</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_asynchronous_specs">Asynchronous specs</h4>
<div class="paragraph">
<p>Writing Asynchronous specs can be tricky at first. Some examples.</p>
</div>
<div class="sect4">
<h5 id="_promises">Promises</h5>
<div class="paragraph">
<p>Working with promises is rather easy in Atom. You can use our <code>waitsForPromise</code> function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-coffee" data-lang="coffee">  describe "when we open a file", -&gt;
    it "should be opened in an editor", -&gt;
      waitsForPromise -&gt;
        atom.workspace.open('c.coffee').then (editor) -&gt;
          expect(editor.getPath()).toContain 'c.coffee'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method can be used in the <code>describe</code>, <code>it</code>, <code>beforeEach</code> and <code>afterEach</code> functions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-coffee" data-lang="coffee">describe "when we open a file", -&gt;
  beforeEach -&gt;
    waitsForPromise -&gt;
      atom.workspace.open 'c.coffee'

  it "should be opened in an editor", -&gt;
    expect(atom.workspace.getActiveTextEditor().getPath()).toContain 'c.coffee'</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need to wait for multiple promises use a new <code>waitsForPromise</code> function for each promise. (Caution: Without <code>beforeEach</code> this example will fail!)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-coffee" data-lang="coffee">describe "waiting for the packages to load", -&gt;

  beforeEach -&gt;
    waitsForPromise -&gt;
      atom.workspace.open('sample.js')
    waitsForPromise -&gt;
      atom.packages.activatePackage('tabs')
    waitsForPromise -&gt;
      atom.packages.activatePackage('tree-view')

  it 'should have waited long enough', -&gt;
    expect(atom.packages.isPackageActive('tabs')).toBe true
    expect(atom.packages.isPackageActive('tree-view')).toBe true</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_asynchronous_functions_with_callbacks">Asynchronous functions with callbacks</h5>
<div class="paragraph">
<p>Specs for asynchronous functions can be done using the <code>waitsFor</code> and <code>runs</code> functions. A simple example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-coffee" data-lang="coffee">describe "fs.readdir(path, cb)", -&gt;
  it "is async", -&gt;
    spy = jasmine.createSpy('fs.readdirSpy')

    fs.readdir('/tmp/example', spy)
    waitsFor -&gt;
      spy.callCount &gt; 0
    runs -&gt;
      exp = [null, ['example.coffee']]
      expect(spy.mostRecentCall.args).toEqual exp
      expect(spy).toHaveBeenCalledWith(null, ['example.coffee'])</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a more detailed documentation on asynchronous tests please visit the <a href="http://jasmine.github.io/1.3/introduction.html#section-Asynchronous_Support)">Jasmine documentation</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_running_specs">Running specs</h4>
<div class="paragraph">
<p>Most of the time you&#8217;ll want to run specs by triggering the <code>window:run-package-specs</code> command. This command is not only to run package specs, it is also for Atom core specs. This will run all the specs in the current project&#8217;s spec directory. If you want to run the Atom core specs and <strong>all</strong> the default package specs trigger the <code>window:run-all-specs</code> command.</p>
</div>
<div class="paragraph">
<p>To run a limited subset of specs use the <code>fdescribe</code> or <code>fit</code> methods. You can use those to focus a single spec or several specs. In the example above, focusing an individual spec looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-coffee" data-lang="coffee">describe "when a test is written", -&gt;
  fit "has some expectations that should pass", -&gt;
    expect("apples").toEqual("apples")
    expect("oranges").not.toEqual("apples")</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_running_on_ci">Running on CI</h5>
<div class="paragraph">
<p>It is now easy to run the specs in a CI environment like Travis and AppVeyor. See the <a href="http://blog.atom.io/2014/04/25/ci-for-your-packages.html">Travis CI For Your Packages</a> and <a href="http://blog.atom.io/2014/07/28/windows-ci-for-your-packages.html">AppVeyor CI For Your Packages</a> posts for more details.</p>
</div>
</div>
<div class="sect4">
<h5 id="_running_via_the_command_line">Running via the command line</h5>
<div class="paragraph">
<p>To run tests on the command line, run Atom with the <code>--test</code> flag followed by one or more paths to test files or directories. You can also specify a <code>--timeout</code> option, which will force-terminate your tests after a certain number of seconds have passed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>atom --test --timeout 60 ./test/test-1.js ./test/test-2.js</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_your_test_runner">Customizing your test runner</h4>
<div class="paragraph">
<p><strong>Note: This API is available as of 1.2.0-beta0, and it is experimental and subject to change. Test runner authors should be prepared to test their code against future beta releases until it stabilizes.</strong></p>
</div>
<div class="paragraph">
<p>By default, package tests are run with Jasmine 1.3, which is outdated but can&#8217;t be changed for compatibility reasons. You can specify your own custom test runner by including an <code>atomTestRunner</code> field in your <code>package.json</code>. Atom will require whatever module you specify in this field, so you can use a relative path or the name of a module in your package&#8217;s dependencies.</p>
</div>
<div class="paragraph">
<p>Your test runner module must export a single function, which Atom will call within a new window to run your package&#8217;s tests. Your function will be called with the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>testPaths</code> An array of paths to tests to run. Could be paths to files or directories.</p>
</li>
<li>
<p><code>buildAtomEnvironment</code> A function that can be called to construct an instance of the <code>atom</code> global. No <code>atom</code> global will be explicitly assigned, but you can assign one in your runner if desired. This function should be called with the following parameters:</p>
</li>
<li>
<p><code>applicationDelegate</code> An object responsible for Atom&#8217;s interaction with the browser process and host OS. Use <code>buildDefaultApplicationDelegate</code> for a default instance. You can override specific methods on this object to prevent or test these interactions.</p>
</li>
<li>
<p><code>window</code> A window global.</p>
</li>
<li>
<p><code>document</code> A document global.</p>
</li>
<li>
<p><code>configDirPath</code> A path to the configuration directory (usually <code>~/.atom</code>).</p>
</li>
<li>
<p><code>enablePersistence</code> A boolean indicating whether the Atom environment should save or load state from the file system. You probably want this to be <code>false</code>.</p>
</li>
<li>
<p><code>buildDefaultApplicationDelegate</code> A function that builds a default instance of the application delegate, suitable to be passed as the <code>applicationDelegate</code> parameter to <code>buildAtomEnvironment</code>.</p>
</li>
<li>
<p><code>logFile</code> An optional path to a log file to which test output should be logged.</p>
</li>
<li>
<p><code>headless</code> A boolean indicating whether or not the tests are being run from the command line via <code>atom --test</code>.</p>
</li>
<li>
<p><code>legacyTestRunner</code> This function can be invoked to run the legacy Jasmine runner, giving your package a chance to transition to a new test runner while maintaining a subset of its tests in the old environment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Your function should return a promise that resolves to an exit code when your tests are finish running. This exit code will be returned when running your tests via the command line.</p>
</div>
</div>
</div>
          </div>
        </div>
      </div>
      <div class="footer-pad"></div>
    </div>
    <footer>
  <div class="footer">
    <div class="wrapper no-pad">
      <ul class="footer-left">
        <li><a href="#" data-proofer-ignore>Terms of Use</a></li>
        <li><a href="https://help.github.com/articles/github-privacy-policy/" data-proofer-ignore>Privacy</a></li>
        <li><a href="http://contributor-covenant.org/version/1/2/0" data-proofer-ignore>Code of Conduct</a></li>
        <li><a href="#" data-proofer-ignore>Releases</a></li>
        <li><a href="#" data-proofer-ignore>FAQ</a></li>
        <li><a href="#" data-proofer-ignore>Roadmap</a></li>
        <li><a href="#" data-proofer-ignore>Contact</a></li>
      </ul>

      <div class="footer-right">

      </div>
    </div>
  </div>
</footer>

  </body>
</html>
